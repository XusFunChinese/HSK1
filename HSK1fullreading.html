<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HSK 1 Reading Logic 100 - XUSFUNCHINESE</title>
    <style>
        :root {
            --primary: #01579b; --gold: #fbc02d; --pinyin-red: #d63031;
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
            --glass: rgba(255, 255, 255, 0.15);
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: "Arial Black", sans-serif; overflow: hidden; background: var(--night-sky); color: white; }
        
        ruby { ruby-align: center; }
        rt { font-family: Arial, sans-serif; font-size: 0.45em; color: var(--gold); font-weight: normal; margin-bottom: 2px; }

        #cover-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--night-sky); z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.8s; text-align: center; }
        .cover-title { font-size: 32px; color: var(--gold); margin-bottom: 10px; text-shadow: 0 0 15px rgba(251,192,45,0.5); }
        .mode-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 0 15px; width: 95%; max-width: 500px; }
        .mode-btn { padding: 12px; background: transparent; border: 2px solid var(--gold); color: white; border-radius: 12px; cursor: pointer; transition: 0.3s; display: flex; flex-direction: column; align-items: center; }
        .mode-btn b { font-size: 14px; margin-bottom: 4px; }
        .mode-btn span { font-size: 11px; opacity: 0.8; font-family: sans-serif; }
        .mode-btn:hover { background: var(--gold); color: #000; }
        
        #app { display: none; height: 100vh; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .progress-bar { flex-grow: 1; height: 8px; background: rgba(255,255,255,0.2); margin: 0 10px; border-radius: 4px; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; background: var(--gold); transition: 0.3s; }
        
        .content-card { background: var(--glass); backdrop-filter: blur(20px); border-radius: 20px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        #reading-text { font-size: 22px; line-height: 2.6; margin-bottom: 20px; max-width: 95%; }
        #sub-text { font-size: 20px; line-height: 2.6; color: #fff; margin-top: 15px; border-top: 2px dashed rgba(255,255,255,0.2); padding-top: 15px; width: 85%; }
        
        .option-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 600px; margin-top: 10px; }
        .opt-item { background: white; color: #001f3f; padding: 15px; border-radius: 15px; font-size: 18px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .opt-img { font-size: 45px; }

        .overlay-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #001122; z-index: 6000; display: none; padding: 20px; box-sizing: border-box; }
        .scroll-area { height: 85%; overflow-y: auto; margin-top: 15px; }
        .list-item { padding: 15px; border-bottom: 1px solid #333; color: white; cursor: pointer; line-height: 1.8; }
        .list-item:active { background: #01579b; }

        #summary-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--night-sky); z-index: 8000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        #feedback-pop { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 120px; display: none; z-index: 9000; pointer-events: none; }
    </style>
</head>
<body>

<div id="cover-page">
    <div style="font-size: 50px; margin-bottom: 10px;">ğŸ®</div>
    <h1 class="cover-title">HSK 1 READING 100<br><small style="font-size:16px; opacity:0.8; font-family:sans-serif;">Full Reading Modules with Pinyin</small></h1>
    <div class="mode-grid">
        <button class="mode-btn" onclick="startApp(0)">
            <b>Part 1: Vocabulary</b>
            <span>Word-Image matching</span>
        </button>
        <button class="mode-btn" onclick="startApp(20)">
            <b>Part 2: Sentences</b>
            <span>Match sentences to pictures</span>
        </button>
        <button class="mode-btn" onclick="startApp(40)">
            <b>Part 3: Dialogues</b>
            <span>Conversation pairing</span>
        </button>
        <button class="mode-btn" onclick="startApp(60)">
            <b>Part 4: Cloze</b>
            <span>Fill in the missing words</span>
        </button>
        <button class="mode-btn" onclick="startApp(80)" style="grid-column: span 2; border-color: #4cd137;">
            <b>Part 5: Logic Reasoning</b>
            <span>Deep reading comprehension</span>
        </button>
    </div>
    <button class="mode-btn" style="margin-top:15px; width: 220px; border-color: #fff;" onclick="toggleOverlay('mistake-view', true)">
        <b>Mistake Book</b>
        <span>Review failed questions</span>
    </button>
</div>

<div id="summary-screen">
    <h1 style="color:var(--gold); font-size: 40px;">WELL DONE!</h1>
    <div id="final-score" style="font-size: 80px; color: var(--gold); margin: 20px 0;">0</div>
    <button class="mode-btn" onclick="location.reload()" style="width: 200px;">Back to Menu</button>
</div>

<div id="app">
    <div class="nav-header">
        <button onclick="exitToCover()" style="background:none; border:1px solid white; color:white; border-radius:8px; padding: 5px 12px; cursor:pointer;">ğŸ </button>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <button onclick="toggleOverlay('list-view', true)" style="background:none; border:1px solid white; color:white; border-radius:8px; padding: 5px 12px; cursor:pointer;">ğŸ“œ</button>
    </div>
    <div class="content-card">
        <div id="q-mode" style="background:var(--pinyin-red); color:white; padding:2px 10px; border-radius:5px; font-size:12px; margin-bottom:10px; display:none; font-weight:bold;">REVIEWING MISTAKES</div>
        <div id="q-info" style="color: var(--gold); font-size: 14px; margin-bottom: 10px;">PART</div>
        <div id="reading-text"></div>
        <div id="sub-text"></div>
        <div id="visual-content" style="font-size: 100px; margin-bottom: 10px;"></div>
        <div class="option-container" id="options-grid"></div>
    </div>
</div>

<div id="list-view" class="overlay-view">
    <h2 style="color:var(--gold)">Question List (Full Content)</h2>
    <div class="scroll-area" id="list-content"></div>
    <button class="mode-btn" style="width:100%; margin-top:10px;" onclick="toggleOverlay('list-view', false)">Back</button>
</div>

<div id="mistake-view" class="overlay-view">
    <h2 style="color:var(--pinyin-red)">Mistake Book</h2>
    <div class="scroll-area" id="mistake-content"></div>
    <button class="mode-btn" style="width:100%; margin-top:10px;" onclick="toggleOverlay('mistake-view', false)">Close</button>
</div>

<div id="feedback-pop"></div>

<script>
const pyMap = {"æˆ‘":"wÇ’","ä½ ":"nÇ","ä»–":"tÄ","å¥¹":"tÄ","ä»¬":"men","å¥½":"hÇo","æ˜¯":"shÃ¬","ä¸":"bÃ¹","æœ‰":"yÇ’u","åœ¨":"zÃ i","ä¸ª":"gÃ¨","è¿™":"zhÃ¨","é‚£":"nÃ ","å“ª":"nÇ","è°":"shÃ©i","ä»€":"shÃ©n","ä¹ˆ":"me","å‡ ":"jÇ","å²":"suÃ¬","å«":"jiÃ o","å":"mÃ­ng","å­—":"zi","å–":"hÄ“","èŒ¶":"chÃ¡","åƒ":"chÄ«","ç±³":"mÇ","é¥­":"fÃ n","æ°´":"shuÇ","æœ":"guÇ’","è‹¹":"pÃ­ng","è€":"lÇo","å¸ˆ":"shÄ«","å­¦":"xuÃ©","ç”Ÿ":"shÄ“ng","åŒ":"tÃ³ng","æ ¡":"xiÃ o","åŒ»":"yÄ«","é™¢":"yuÃ n","å•†":"shÄng","åº—":"diÃ n","é¦†":"guÇn","ç”µ":"diÃ n","è§†":"shÃ¬","å½±":"yÇng","è„‘":"nÇo","ä¹¦":"shÅ«","è¡£":"yÄ«","æœ":"fÃº","æ¯":"bÄ“i","å­":"zi","é’±":"qiÃ¡n","å—":"kuÃ i","é£":"fÄ“i","æœº":"jÄ«","å‡º":"chÅ«","ç§Ÿ":"zÅ«","è½¦":"chÄ“","å":"zuÃ²","ä¹°":"mÇi","çœ‹":"kÃ n","å¬":"tÄ«ng","è¯´":"shuÅ","è¯»":"dÃº","å†™":"xiÄ›","å¼€":"kÄi","å›":"huÃ­","æ¥":"lÃ¡i","å»":"qÃ¹","æƒ³":"xiÇng","èƒ½":"nÃ©ng","ä¼š":"huÃ¬","è¯·":"qÇng","è°¢":"xiÃ¨","å®¢":"kÃ¨","æ°”":"qi","å¯¹":"duÃ¬","èµ·":"qÇ","æ²¡":"mÃ©i","å…³":"guÄn","ç³»":"xi","å†":"zÃ i","è§":"jiÃ n","å¾ˆ":"hÄ›n","å¤ª":"tÃ i","å¤š":"duÅ","å°‘":"shÇo","å¤§":"dÃ ","å°":"xiÇo","å†·":"lÄ›ng","çƒ­":"rÃ¨","æ˜¨":"zuÃ³","å¤©":"tiÄn","ä»Š":"jÄ«n","æ˜":"mÃ­ng","å¹´":"niÃ¡n","æœˆ":"yuÃ¨","æ—¥":"rÃ¬","å·":"hÃ o","æ˜Ÿ":"xÄ«ng","æœŸ":"qÄ«","ç‚¹":"diÇn","åˆ†":"fÄ“n","é’Ÿ":"zhÅng","ç°":"xiÃ n","é‡Œ":"lÇ","ä¸Š":"shÃ ng","ä¸‹":"xiÃ ","å‰":"qiÃ¡n","å":"hÃ²u","ä¸­":"zhÅng","å›½":"guÃ³","åŒ—":"bÄ›i","äº¬":"jÄ«ng","é›¨":"yÇ”","å’Œ":"hÃ©","å‘¢":"ne","å—":"ma","å§":"ba","è¯†":"shÃ­","è®¤":"rÃ¨n","åš":"zuÃ²","çŒ«":"mÄo","ç‹—":"gÇ’u","æ¼‚äº®":"piÃ o liang","æ±‰è¯­":"hÃ n yÇ”","å–œæ¬¢":"xÇ huan","è°¢è°¢":"xiÃ¨ xie","è®¤è¯†":"rÃ¨n shi","åŒ»ç”Ÿ":"yÄ« shÄ“ng","è€å¸ˆ":"lÇo shÄ«","åŒå­¦":"tÃ³ng xuÃ©","å­¦ç”Ÿ":"xuÃ© sheng","åŒ—äº¬":"bÄ›i jÄ«ng","è‹¹æœ":"pÃ­ng guÇ’","å–èŒ¶":"hÄ“ chÃ¡","å›å®¶":"huÃ­ jiÄ","çœ‹ä¹¦":"kÃ n shÅ«","è¯´è¯":"shuÅ huÃ ","å†™å­—":"xiÄ› zÃ¬","å¤©æ°”":"tiÄn qÃ¬","ç°åœ¨":"xiÃ n zÃ i","å¤šå°‘":"duÅ shao","å†è§":"zÃ i jiÃ n","å¯¹ä¸èµ·":"duÃ¬ bu qÇ","æ²¡å…³ç³»":"mÃ©i guÄn xi","ä¸å®¢æ°”":"bÃ¹ kÃ¨ qi","æ¤…å­":"yÇ zi","æ¡Œå­":"zhuÅ zi","ç”µè§†":"diÃ n shÃ¬","ç”µè„‘":"diÃ n nÇo","ç”µå½±":"diÃ n yÇng","å¥³å„¿":"nÇš Ã©r","æœ‹å‹":"pÃ©ng you","é«˜å…´":"gÄo xÃ¬ng","è¥¿ç“œ":"xÄ« guÄ","å·¥ä½œ":"gÅng zuÃ²","èº«ä½“":"shÄ“n tÇ","æ²¡å»":"mÃ©i qÃ¹","æ˜å¤©":"mÃ­ng tiÄn","ç¾å›½":"mÄ›i guÃ³","æ¯å¤©":"mÄ›i tiÄn","å¥½çœ‹":"hÇo kÃ n"};

function toRuby(str) {
    if(!str) return "";
    let res = ""; let i = 0;
    while(i < str.length) {
        let match = false;
        for(let l=4; l>=2; l--) {
            let sub = str.substr(i, l);
            if(pyMap[sub]) {
                let pys = pyMap[sub].split(' ');
                for(let j=0; j<sub.length; j++) res += `<ruby>${sub[j]}<rt>${pys[j]||''}</rt></ruby>`;
                i += l; match = true; break;
            }
        }
        if(!match) {
            let char = str[i];
            res += pyMap[char] ? `<ruby>${char}<rt>${pyMap[char]}</rt></ruby>` : char;
            i++;
        }
    }
    return res;
}

const questions = [];
let currentIdx = 0, partScores = [0,0,0,0,0], isMistakeMode = false;
let mistakes = JSON.parse(localStorage.getItem('hsk1_r100_final_v12') || '[]');

function buildData() {
    const v = [{c:"åŒ»ç”Ÿ",e:"ğŸ‘¨â€âš•ï¸"},{c:"è‹¹æœ",e:"ğŸ"},{c:"å–èŒ¶",e:"â˜•"},{c:"çœ‹ä¹¦",e:"ğŸ“–"},{c:"å°çŒ«",e:"ğŸ±"},{c:"ç”µè„‘",e:"ğŸ’»"},{c:"é£æœº",e:"âœˆï¸"},{c:"å‡ºç§Ÿè½¦",e:"ğŸš•"},{c:"è¡£æœ",e:"ğŸ‘•"},{c:"ä¸‹é›¨",e:"ğŸŒ§ï¸"},{c:"è€å¸ˆ",e:"ğŸ‘©â€ğŸ«"},{c:"å­¦ç”Ÿ",e:"ğŸ§’"},{c:"æ¡Œå­",e:"ğŸª‘"},{c:"æ°´æœ",e:"ğŸ‡"},{c:"æ¤…å­",e:"ğŸ’º"},{c:"å•†åº—",e:"ğŸª"},{c:"é¥­åº—",e:"ğŸ±"},{c:"å­¦æ ¡",e:"ğŸ«"},{c:"åŒ»é™¢",e:"ğŸ¥"},{c:"ç”µå½±",e:"ğŸ¬"}];
    v.forEach((it, i) => { let isT = Math.random()>0.5; questions.push({id:i, type:1, text:it.c, visual:isT?it.e:v[(i+3)%20].e, answer:isT, title:"Part 1: Match"}); });
    const p2s = ["å¥¹åœ¨å–èŒ¶ã€‚","ä»–åœ¨çœ‹ç”µå½±ã€‚","æˆ‘æƒ³ä¹°è‹¹æœã€‚","æˆ‘ä¼šå†™æ±‰å­—ã€‚","ä»–åœ¨å•†åº—ã€‚","é‚£æ˜¯è€å¸ˆã€‚","è¡£æœå¾ˆæ¼‚äº®ã€‚","å¤–é¢ä¸‹é›¨äº†ã€‚","åå‡ºç§Ÿè½¦ã€‚","åœ¨é¥­åº—åƒé¥­ã€‚","é‚£æ˜¯ç”µè„‘ã€‚","å­¦æ ¡æœ‰äººã€‚","åœ¨æ¡Œå­ä¸‹ã€‚","æƒ³åƒæ°´æœã€‚","å»åŒ—äº¬ã€‚","ä»–åœ¨çœ‹ä¹¦ã€‚","åŒ»ç”Ÿåœ¨åŒ»é™¢ã€‚","ååœ¨æ¤…å­ä¸Šã€‚","åé£æœºã€‚","å°çŒ«ç¡è§‰ã€‚"];
    const p2e = ["â˜•","ğŸ¬","ğŸ","âœï¸","ğŸª","ğŸ‘©â€ğŸ«","ğŸ‘•","ğŸŒ§ï¸","ğŸš•","ğŸ±","ğŸ’»","ğŸ«","ğŸª‘","ğŸ‡","ğŸ™ï¸","ğŸ“–","ğŸ‘¨â€âš•ï¸","ğŸ’º","âœˆï¸","ğŸ±"];
    p2s.forEach((s,i)=>{ let opts=[p2e[i],"ğŸ ","ğŸ¥¤","ğŸš²"].sort(()=>Math.random()-0.5); questions.push({id:i+20, type:2, text:s, options:opts, answer:opts.indexOf(p2e[i]), title:"Part 2: Select"}); });
    const p3q = ["è°¢è°¢ä½ ã€‚","å†è§ã€‚","ä½ å«ä»€ä¹ˆï¼Ÿ","ä½ æ˜¯å“ªå›½äººï¼Ÿ","ä¼šè¯´æ±‰è¯­å—ï¼Ÿ","å‡ ç‚¹äº†ï¼Ÿ","å¤šå°‘é’±ï¼Ÿ","ä½ åœ¨å“ªå„¿ï¼Ÿ","å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ","ä»–å¤šå¤§äº†ï¼Ÿ","æƒ³å–ä»€ä¹ˆï¼Ÿ","è°æ˜¯è€å¸ˆï¼Ÿ","è¿™ä¸ªå­—æ€ä¹ˆè¯»ï¼Ÿ","åŒ—äº¬æ¼‚äº®å—ï¼Ÿ","æœ‰çŒ«å—ï¼Ÿ","åœ¨åšä»€ä¹ˆï¼Ÿ","è®¤è¯†ä»–å—ï¼Ÿ","æ˜ŸæœŸå‡ ï¼Ÿ","åœ¨å“ªå„¿å·¥ä½œï¼Ÿ","ä½ å¥½å—ï¼Ÿ"];
    const p3a = ["ä¸å®¢æ°”ã€‚","æ˜å¤©è§ã€‚","æˆ‘å«å¤§å«ã€‚","æˆ‘æ˜¯ç¾å›½äººã€‚","ä¼šè¯´ä¸€ç‚¹å„¿ã€‚","ä¸‰ç‚¹é’Ÿã€‚","åå—é’±ã€‚","åœ¨å­¦æ ¡ã€‚","å¤ªçƒ­äº†ã€‚","äºŒåå²ã€‚","æƒ³å–æ°´ã€‚","ç‹è€å¸ˆã€‚","ä¸è®¤è¯†ã€‚","å¾ˆæ¼‚äº®ã€‚","æœ‰ä¸€åªã€‚","åœ¨ç¡è§‰ã€‚","ä¸è®¤è¯†ã€‚","æ˜ŸæœŸäº”ã€‚","åœ¨åŒ»é™¢ã€‚","æˆ‘å¾ˆå¥½ã€‚"];
    p3q.forEach((q,i)=>{ let opts=[p3a[i],"æ²¡å…³ç³»ã€‚","æ²¡å»ã€‚","åœ¨ä¸Šé¢ã€‚"].sort(()=>Math.random()-0.5); questions.push({id:i+40, type:3, text:q, options:opts, answer:opts.indexOf(p3a[i]), title:"Part 3: Pairing"}); });
    const p4d = [["å____å»åŒ—äº¬ã€‚","é£æœº"],["è¯´____å—ï¼Ÿ","æ±‰è¯­"],["ä»Šå¤©____å¥½ã€‚","å¤©æ°”"],["è¯·____èŒ¶ã€‚","å–"],["____é’±ï¼Ÿ","å¤šå°‘"],["åœ¨____å·¥ä½œã€‚","åŒ»é™¢"],["æ¡Œå­____ã€‚","ä¸Š"],["____ç”µè§†ã€‚","çœ‹"],["ä¸____ä»–ã€‚","è®¤è¯†"],["å¾ˆé«˜å…´____ä½ ã€‚","è®¤è¯†"],["å»____ä¹°ä¸œè¥¿ã€‚","å•†åº—"],["____ç‚¹é’Ÿï¼Ÿ","å‡ "],["æˆ‘çš„____ã€‚","åå­—"],["ä¸‹____äº†ã€‚","é›¨"],["ä»–äºŒå____ã€‚","å²"],["é‚£æ˜¯____ï¼Ÿ","è°"],["ä½ åœ¨åš____ï¼Ÿ","å‘¢"],["å¥¹æ˜¯æˆ‘____ã€‚","å¥³å„¿"],["è¡£æœ____ã€‚","æ¼‚äº®"],["è°¢è°¢____ã€‚","ä½ "]];
    p4d.forEach((d,i)=>{ let opts=[d[1],"ç”µè„‘","æ°´æœ","æ¤…å­"].sort(()=>Math.random()-0.5); questions.push({id:i+60, type:4, text:d[0], options:opts, answer:opts.indexOf(d[1]), title:"Part 4: Blanks"}); });
    
    const p5d = [
        {t:"ä»–æ˜¯æˆ‘çš„å¥½æœ‹å‹ï¼Œä»–åœ¨åŒ»é™¢å·¥ä½œã€‚ä»–æ˜¯ä¸€ä½åŒ»ç”Ÿï¼Œæ¯å¤©éƒ½å¾ˆå¿™ã€‚æˆ‘å¾ˆå–œæ¬¢ä»–ã€‚", q:"æˆ‘çš„æœ‹å‹æ¯å¤©éƒ½å¾ˆå¿™ã€‚", a:true},
        {t:"æˆ‘ä¸å–œæ¬¢å–èŒ¶ï¼Œæˆ‘å–œæ¬¢å–å†·æ°´ã€‚ä»Šå¤©å¤©æ°”å¾ˆçƒ­ï¼Œæˆ‘æƒ³ä¹°ä¸€ä¸ªå¤§è¥¿ç“œã€‚", q:"ä»–å£æ¸´äº†ï¼Œæƒ³å–èŒ¶ã€‚", a:false},
        {t:"åŒ—äº¬ä»Šå¤©ä¸‹å¤§é›¨äº†ï¼Œå¤©æ°”å¾ˆå†·ã€‚æˆ‘æ²¡å»å•†åº—ä¹°è¡£æœï¼Œæˆ‘åœ¨å®¶çœ‹ç”µè§†ã€‚", q:"ä»–ä»Šå¤©æ²¡å‡ºé—¨ã€‚", a:true},
        {t:"é‚£ä¸ªå•†åº—çš„æ¯å­å¾ˆæ¼‚äº®ï¼Œä¸€ä¸ªæ¯å­ä¹å—é’±ï¼Œæˆ‘æƒ³ä¹°ä¸¤ä¸ªé€ç»™åŒå­¦ã€‚", q:"ä»–è¦èŠ±åå…«å—é’±ã€‚", a:true},
        {t:"ç‹è€å¸ˆæœ‰äº”ä¸ªå­¦ç”Ÿï¼Œç°åœ¨ä»–ä»¬åœ¨å­¦æ ¡çœ‹ä¹¦ï¼Œæ²¡åœ¨å¤–é¢å†™å­—ã€‚", q:"å­¦ç”Ÿä»¬ä¸åœ¨å­¦æ ¡ã€‚", a:false},
        {t:"æˆ‘å®¶æœ‰ä¸€åªå°çŒ«ï¼Œå®ƒå«å°èŠ±ã€‚å®ƒä»Šå¹´ä¸‰å²äº†ï¼Œéå¸¸æ¼‚äº®ï¼Œå¾ˆå¬è¯ã€‚", q:"å°èŠ±æ˜¯çŒ«çš„åå­—ã€‚", a:true},
        {t:"ä¸‹åˆå››ç‚¹ï¼Œæˆ‘å’ŒåŒå­¦å»é¥­åº—åƒé¥­ã€‚æˆ‘ä»¬æƒ³åƒç±³é¥­å’Œä¸€äº›ä¸­å›½èœã€‚", q:"ä»–ä»¬åœ¨åƒç¾å›½èœã€‚", a:false},
        {t:"ä»Šå¤©æ˜ŸæœŸæ—¥ï¼Œæˆ‘æ²¡å»å·¥ä½œã€‚ä¸‹åˆæˆ‘å»å­¦æ ¡çœ‹å¥³å„¿ï¼Œå¥¹åœ¨é‚£å„¿è¯»æ±‰è¯­ä¹¦ã€‚", q:"ä»–å¥³å„¿åœ¨å­¦ä¹ ã€‚", a:true},
        {t:"è¿™ä¸ªç”µå½±å«ã€Šä½ å¥½ã€‹ï¼Œå¾ˆå¥½çœ‹ã€‚æˆ‘çœ‹è¿‡å¾ˆå¤šæ¬¡ï¼Œæˆ‘çš„æœ‹å‹ä¹Ÿè¯´å¾ˆå¥½çœ‹ã€‚", q:"ä»–ç¬¬ä¸€æ¬¡çœ‹è¿™éƒ¨ç”µå½±ã€‚", a:false},
        {t:"æˆ‘ä¼šè¯´ä¸€ç‚¹å„¿æ±‰è¯­ï¼Œä½†ä¸ä¼šå†™æ±‰å­—ã€‚æ˜å¤©æˆ‘æƒ³å»å­¦æ ¡å­¦ä¹ æ€ä¹ˆå†™å­—ã€‚", q:"ä»–æƒ³å­¦ä¹ å†™æ±‰å­—ã€‚", a:true},
        {t:"æ¡Œå­ä¸Šæœ‰ä¸€ä¸ªç”µè„‘å’Œå‡ æœ¬ä¹¦ï¼Œé‚£æ˜¯å¤§å«çš„ã€‚ä»–åœ¨åŒ—äº¬å­¦ä¹ æ±‰è¯­ï¼Œæ˜¯ä¸ªå¥½å­¦ç”Ÿã€‚", q:"æ¡Œå­æ˜¯å¤§å«çš„ã€‚", a:false},
        {t:"æˆ‘æ²¡åå‡ºç§Ÿè½¦ï¼Œæˆ‘æ˜å¤©åé£æœºå»åŒ—äº¬ã€‚åŒ—äº¬æ˜¯ä¸€ä¸ªå¤§åŸå¸‚ï¼Œé‚£å„¿æœ‰å¾ˆå¤šå¥½å•†åº—ã€‚", q:"ä»–ç°åœ¨åœ¨åŒ—äº¬ã€‚", a:false},
        {t:"å¥¹æ˜¯æˆ‘çš„æ±‰è¯­è€å¸ˆï¼Œå¥¹ä»Šå¹´ä¸‰åå²äº†ã€‚å¥¹å»è¿‡å¾ˆå¤šå›½å®¶ï¼Œè®¤è¯†å¾ˆå¤šå­¦ç”Ÿã€‚", q:"è€å¸ˆè®¤è¯†å¾ˆå¤šäººã€‚", a:true},
        {t:"æ˜¨å¤©æ˜¯æ˜ŸæœŸäº”ï¼Œæ˜å¤©æ˜¯æ˜ŸæœŸæ—¥ã€‚ä»Šå¤©æˆ‘æœ‰æ—¶é—´ï¼Œæˆ‘æƒ³å»ç”µå½±é™¢çœ‹ç”µå½±ã€‚", q:"æ˜¨å¤©ä»–å»çœ‹ç”µå½±äº†ã€‚", a:false},
        {t:"è¿™ä¸ªè‹¹æœå¾ˆå¤§ï¼Œä¹Ÿå¾ˆçº¢ã€‚æˆ‘å¾ˆå–œæ¬¢åƒæ°´æœï¼ŒåŒ»ç”Ÿè¯´å¤šåƒæ°´æœå¯¹èº«ä½“å¥½ã€‚", q:"åƒæ°´æœå¯¹ä»–å¥½ã€‚", a:true},
        {t:"ä»–åœ¨æˆ¿é—´é‡Œçœ‹ä¹¦ï¼Œæ²¡å‡ºæ¥å–èŒ¶ã€‚ä»–æƒ³åœ¨ä¸‹ä¸ªæ˜ŸæœŸå‰è¯»å®Œè¿™æœ¬åšåšçš„å°è¯´ã€‚", q:"ä»–åœ¨å¤–é¢å–èŒ¶ã€‚", a:false},
        {t:"é‚£æ˜¯ç‹å…ˆç”Ÿçš„è¡£æœï¼Œæ˜¯åœ¨åŒ—äº¬ä¹°çš„ã€‚é‚£ä»¶è¡£æœå¾ˆè´µï¼Œä½†æ˜¯ä»–éå¸¸å–œæ¬¢ã€‚", q:"è¡£æœå¾ˆä¾¿å®œã€‚", a:false},
        {t:"æˆ‘å®¶åœ¨åŒ—äº¬é¥­åº—åé¢ï¼Œé‚£å„¿æœ‰å¾ˆå¤šå°å•†åº—ã€‚æ¯å¤©æœ‰å¾ˆå¤šå­¦ç”Ÿåœ¨é‚£å„¿ä¹°æ°´ã€‚", q:"å­¦ç”Ÿåœ¨å•†åº—ä¹°ä¸œè¥¿ã€‚", a:true},
        {t:"è¯·ååœ¨æ¤…å­ä¸Šï¼Œå–æ¯çƒ­æ°´ã€‚å¤©æ°”å†·äº†ï¼Œä½ è¦å¤šç©¿ä¸€ç‚¹å„¿è¡£æœï¼Œåˆ«ç”Ÿç—…ã€‚", q:"ç°åœ¨å¤©æ°”å¾ˆçƒ­ã€‚", a:false},
        {t:"ä»–åœ¨æ‰“ç”µè¯ï¼Œä»–åœ¨å’Œå¦ˆå¦ˆè¯´è¯ã€‚ä»–è¯´æ˜å¤©å›äº¬ï¼Œæƒ³åƒå¦ˆå¦ˆåšçš„ç±³é¥­ã€‚", q:"ä»–åœ¨å’Œå¦ˆå¦ˆåƒé¥­ã€‚", a:false}
    ];
    p5d.forEach((d,i)=>questions.push({id:i+80, type:5, text:d.t, sub:d.q, answer:d.a, title:"Part 5: Logic"}));
}

function startApp(idx) { currentIdx=idx; isMistakeMode=false; document.getElementById('cover-page').style.transform='translateY(-100%)'; document.getElementById('app').style.display='flex'; renderQuestion(); }

function renderQuestion() {
    const q = isMistakeMode?mistakes[currentIdx]:questions[currentIdx];
    document.getElementById('q-info').innerText = `${q.title} - ${isMistakeMode?(currentIdx+1)+'/'+mistakes.length:(currentIdx%20+1)+'/20'}`;
    document.getElementById('progress-fill').style.width = isMistakeMode?`${(currentIdx+1)/mistakes.length*100}%`:`${(currentIdx%20+1)/20*100}%`;
    document.getElementById('reading-text').innerHTML = toRuby(q.text);
    document.getElementById('sub-text').innerHTML = q.sub?toRuby(q.sub):"";
    const grid = document.getElementById('options-grid'); const visual = document.getElementById('visual-content');
    grid.innerHTML = ''; visual.style.display = (q.type===1)?'block':'none';
    if(q.type===1 || q.type===5) {
        if(q.type===1) visual.innerText = q.visual;
        grid.innerHTML = `<div class="opt-item" onclick="handleAns(true)">${toRuby('å¯¹')} True</div><div class="opt-item" onclick="handleAns(false)">${toRuby('é”™')} False</div>`;
    } else {
        q.options.forEach((o,i)=>grid.innerHTML += `<div class="opt-item ${q.type===2?'opt-img':''}" onclick="handleAns(${i})">${q.type===2?o:toRuby(o)}</div>`);
    }
}

function handleAns(c) {
    const q = isMistakeMode?mistakes[currentIdx]:questions[currentIdx];
    const isR = c===q.answer;
    const fb = document.getElementById('feedback-pop'); fb.innerText = isR?"âœ”ï¸":"âŒ"; fb.style.color = isR?"#4cd137":"#ff4757"; fb.style.display='block';
    if(isR) { if(isMistakeMode) mistakes.splice(currentIdx, 1); else partScores[Math.floor(q.id/20)]++; }
    else if(!isMistakeMode && !mistakes.some(m=>m.id===q.id)) mistakes.push(q);
    localStorage.setItem('hsk1_r100_final_v12', JSON.stringify(mistakes));
    setTimeout(()=>{ fb.style.display='none'; if(isMistakeMode){ if(mistakes.length===0) showSum(true); else {if(currentIdx>=mistakes.length) currentIdx=0; renderQuestion();} } else { if((currentIdx+1)%20===0) showSum(false); else {currentIdx++; renderQuestion();} } }, 800);
}

function showSum(m) { document.getElementById('summary-screen').style.display='flex'; document.getElementById('final-score').innerText = m?100:partScores[Math.floor(currentIdx/20)]*5; }
function toggleOverlay(id, s) { document.getElementById(id).style.display = s?'block':'none'; if(s&&id==='list-view') renderList(); if(s&&id==='mistake-view') renderMistakeList(); }

function renderList() { 
    const content = document.getElementById('list-content');
    content.innerHTML = questions.map((q,i)=>`
        <div class="list-item" onclick="jumpTo(${i}, false)">
            <small style="color:var(--gold)">Q${i+1} [${q.title}]</small><br>
            ${toRuby(q.text.slice(0,30))}${q.text.length>30?'...':''}
        </div>`).join(''); 
}

function renderMistakeList() { 
    const content = document.getElementById('mistake-content');
    content.innerHTML = mistakes.length?mistakes.map((q,i)=>`
        <div class="list-item" onclick="jumpTo(${i}, true)">
            <small style="color:var(--pinyin-red)">Mistake ${i+1}</small><br>
            ${toRuby(q.text.slice(0,30))}...
        </div>`).join(''):"<p style='text-align:center;'>Empty! Keep it up!</p>"; 
}

function jumpTo(i,m) { currentIdx=i; isMistakeMode=m; toggleOverlay(m?'mistake-view':'list-view',false); document.getElementById('q-mode').style.display=m?'inline-block':'none'; document.getElementById('cover-page').style.transform='translateY(-100%)'; document.getElementById('app').style.display='flex'; renderQuestion(); }
function exitToCover() { document.getElementById('cover-page').style.transform='translateY(0)'; }
window.onload = buildData;
</script>
</body>
</html>