<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HSK 1 Reading Master - XUSFUNCHINESE</title>
    <style>
        :root {
            --primary: #01579b; --gold: #fbc02d; --pinyin-red: #ff4757; 
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
            --glass: rgba(255, 255, 255, 0.15);
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: "Arial Black", sans-serif; overflow: hidden; background: var(--night-sky); color: white; }
        
        /* å°é¢é¡µ */
        #cover-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--night-sky); z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.8s; }
        .cover-title { font-size: 50px; color: var(--gold); text-shadow: 0 0 20px rgba(251,192,45,0.6); margin: 0; text-align: center; }
        .mode-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .mode-btn { padding: 15px 25px; background: transparent; border: 2px solid var(--gold); color: white; border-radius: 15px; cursor: pointer; transition: 0.3s; font-size: 16px; display: flex; flex-direction: column; align-items: center; min-width: 160px; }
        .mode-btn:hover { background: var(--gold); color: #000; }

        /* ä¸»ç•Œé¢ */
        #app { display: none; height: 100vh; flex-direction: column; padding: 15px; box-sizing: border-box; }
        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-icon { background: var(--glass); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; }
        .progress-bar { flex-grow: 1; height: 10px; background: rgba(255,255,255,0.2); margin: 0 15px; border-radius: 5px; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; background: var(--gold); transition: 0.3s; }
        
        .content-card { background: var(--glass); backdrop-filter: blur(15px); border-radius: 25px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        
        /* æ‹¼éŸ³å¯¹é½ä¸æ¨ªæ’æ ·å¼ */
        ruby { ruby-align: center; display: inline-flex; flex-direction: column-reverse; vertical-align: bottom; margin: 0 1px; }
        rt { display: block; font-family: "Arial", sans-serif; font-size: 0.4em; color: var(--pinyin-red); font-weight: bold; line-height: 1; margin-bottom: 2px; text-align: center; }
        
        #reading-text { font-size: 32px; color: white; margin-bottom: 30px; text-align: center; line-height: 1.8; padding: 0 10px; font-family: "Microsoft YaHei", sans-serif; white-space: normal; word-break: break-all; }
        
        /* é€‰é¡¹æ¨ªæ’å¸ƒå±€ */
        .option-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 650px; }
        .opt-item { background: white; color: #001f3f; padding: 15px 10px; border-radius: 15px; text-align: center; font-size: 18px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: 2px solid transparent; display: flex; flex-direction: row; align-items: flex-end; justify-content: center; flex-wrap: wrap; }
        .opt-item:active { transform: scale(0.95); }
        .opt-img { font-size: 50px; display: block; width: 100%; }

        /* é®ç½©å±‚ */
        .overlay-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #001122; z-index: 6000; display: none; padding: 20px; box-sizing: border-box; }
        .scroll-area { height: calc(100% - 120px); overflow-y: auto; margin-top: 15px; }
        .list-card { background: rgba(255,255,255,0.08); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        
        /* ç»“ç®—é¡µ */
        #summary-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--night-sky); z-index: 8000; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .score-circle { width: 180px; height: 180px; border: 6px solid var(--gold); border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; margin-bottom: 30px; }
        .footer-nav { display: flex; gap: 20px; margin-top: 20px; width: 100%; max-width: 600px; }
        .nav-arrow { flex: 1; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid white; color: white; border-radius: 10px; cursor: pointer; }
        #feedback-pop { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 120px; display: none; z-index: 9000; pointer-events: none; }
    </style>
</head>
<body>

<div id="cover-page">
    <div style="font-size: 80px;">ğŸ“–</div>
    <h1 class="cover-title">HSK 1 READING<br><small style="font-size:20px; opacity:0.8;">é˜…è¯»ç»ƒä¹ </small></h1>
    <div class="mode-grid">
        <button class="mode-btn" onclick="startApp(0)"><b>Part 1</b><small>Judgement</small></button>
        <button class="mode-btn" onclick="startApp(20)"><b>Part 2</b><small>Sentence-Image</small></button>
        <button class="mode-btn" onclick="startApp(40)"><b>Part 3</b><small>Matching</small></button>
        <button class="mode-btn" onclick="startApp(60)"><b>Part 4</b><small>Fill Blanks</small></button>
    </div>
    <button class="mode-btn" style="margin-top:20px; width: 220px; border-color: #fff;" onclick="toggleOverlay('mistake-view', true)">ğŸ“– Mistake Book</button>
</div>

<div id="summary-screen">
    <h1 id="sum-title" style="color:var(--gold)">READING COMPLETE!</h1>
    <div class="score-circle">
        <div style="font-size: 18px;">FINAL SCORE</div>
        <div class="score-num" id="final-score" style="font-size: 60px; color: var(--gold);">0</div>
    </div>
    <div id="praise-text" style="font-size: 24px; margin-bottom: 30px; padding: 0 20px;"></div>
    <button class="mode-btn" onclick="location.reload()" style="width: 250px;">Return to Menu</button>
</div>

<div id="app">
    <div class="nav-header">
        <button class="btn-icon" onclick="exitToCover()">ğŸ  Home</button>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <button class="btn-icon" onclick="toggleOverlay('list-view', true)">ğŸ“œ List</button>
    </div>
    <div class="content-card">
        <div id="q-mode" style="background:var(--gold); color:black; padding:2px 10px; border-radius:5px; font-size:12px; margin-bottom:10px; display:none;">MISTAKE MODE</div>
        <div id="q-info" style="color: var(--gold); margin-bottom: 10px;">QUESTION 1/20</div>
        
        <div id="reading-text"></div>
        
        <div id="visual-content" style="font-size: 100px; margin-bottom: 20px; line-height: 1;"></div>
        
        <div class="option-container" id="options-grid"></div>
        
        <div class="footer-nav">
            <button class="nav-arrow" onclick="prevQuestion()">â† PREV</button>
            <button class="nav-arrow" onclick="nextQuestion()">NEXT â†’</button>
        </div>
    </div>
</div>

<div id="list-view" class="overlay-view"><h2 style="color:var(--gold)">ğŸ“œ Question List</h2><div class="scroll-area" id="list-content"></div><button class="mode-btn" style="width:100%; margin-top:15px;" onclick="toggleOverlay('list-view', false)">Back</button></div>
<div id="mistake-view" class="overlay-view"><h2 style="color:var(--pinyin-red)">ğŸ“– Mistake Book</h2><div class="scroll-area" id="mistake-content"></div><button class="mode-btn" style="width:100%; margin-top:15px;" onclick="toggleOverlay('mistake-view', false)">Close</button></div>
<div id="feedback-pop"></div>

<script>
// æ‹¼éŸ³æ•°æ®åº“ï¼šæ¯ä¸ªè¯/å¥å¯¹åº”ç©ºæ ¼åˆ†éš”çš„æ‹¼éŸ³åºåˆ—
const pinyinMap = {
    "åŒ»ç”Ÿ":"yÄ« shÄ“ng", "è‹¹æœ":"pÃ­ng guÇ’", "å–èŒ¶":"hÄ“ chÃ¡", "çœ‹ä¹¦":"kÃ n shÅ«", "å°çŒ«":"xiÇo mÄo",
    "ç”µè„‘":"diÃ n nÇo", "é£æœº":"fÄ“ijÄ«", "å‡ºç§Ÿè½¦":"chÅ« zÅ« chÄ“", "è¡£æœ":"yÄ« fu", "ä¸‹é›¨":"xiÃ  yÇ”",
    "è€å¸ˆ":"lÇo shÄ«", "å­¦ç”Ÿ":"xuÃ© sheng", "æ¡Œå­":"zhuÅ zi", "æ°´æœ":"shuÇ guÇ’", "æ¤…å­":"yÇ zi",
    "å•†åº—":"shÄng diÃ n", "é¥­åº—":"fÃ n diÃ n", "å­¦æ ¡":"xuÃ© xiÃ o", "åŒ»é™¢":"yÄ« yuÃ n", "ç”µå½±":"diÃ n yÇng",
    "ä»–åœ¨ä¹¦åº—çœ‹ä¹¦ã€‚":"tÄ zÃ i shÅ« diÃ n kÃ n shÅ« ã€‚", "æˆ‘æƒ³åƒä¸€ä¸ªè‹¹æœã€‚":"wÇ’ xiÇng chÄ« yÄ« gÃ¨ pÃ­ng guÇ’ ã€‚",
    "å¤–é¢ä¸‹é›¨äº†ã€‚":"wÃ i miÃ n xiÃ  yÇ” le ã€‚", "æˆ‘åé£æœºå»åŒ—äº¬ã€‚":"wÇ’ zuÃ² fÄ“i jÄ« qÃ¹ BÄ›i jÄ«ng ã€‚",
    "æè€å¸ˆåœ¨å­¦æ ¡ã€‚":"LÇ lÇo shÄ« zÃ i xuÃ© xiÃ o ã€‚", "å¥¹æœ‰ä¸€åªå°çŒ«ã€‚":"tÄ yÇ’u yÄ« zhÄ« xiÇo mÄo ã€‚",
    "æˆ‘æƒ³å–ä¸€ç‚¹å„¿èŒ¶ã€‚":"wÇ’ xiÇng hÄ“ yÄ« diÇnr chÃ¡ ã€‚", "ä»–åœ¨æ¡Œå­ä¸‹é¢ã€‚":"tÄ zÃ i zhuÅ zi xiÃ  miÃ n ã€‚",
    "æˆ‘å»å•†åº—ä¹°è¡£æœã€‚":"wÇ’ qÃ¹ shÄng diÃ n mÇi yÄ« fu ã€‚", "å¥¹åœ¨åŒ»é™¢å·¥ä½œã€‚":"tÄ zÃ i yÄ« yuÃ n gÅng zuÃ² ã€‚",
    "è¯·ååœ¨æ¤…å­ä¸Šã€‚":"qÇng zuÃ² zÃ i yÇ zi shÃ ng ã€‚", "ä»Šå¤©æœ‰å¤§é›¨ã€‚":"jÄ«n tiÄn yÇ’u dÃ  yÇ” ã€‚",
    "è¿™æ˜¯æˆ‘çš„ç”µè„‘ã€‚":"zhÃ¨ shÃ¬ wÇ’ de diÃ n nÇo ã€‚", "æˆ‘æƒ³çœ‹ç”µå½±ã€‚":"wÇ’ xiÇng kÃ n diÃ n yÇng ã€‚",
    "é¥­åº—é‡Œæœ‰å¾ˆå¤šäººã€‚":"fÃ n diÃ n lÇ yÇ’u hÄ›n duÅ rÃ©n ã€‚", "ä»–åœ¨æ‰“å‡ºç§Ÿè½¦ã€‚":"tÄ zÃ i dÇ chÅ« zÅ« chÄ“ ã€‚",
    "è¿™ä¸ªæ°´æœå¾ˆå¥½åƒã€‚":"zhÃ¨ gÃ¨ shuÇ guÇ’ hÄ›n hÇo chÄ« ã€‚", "å¥¹æ˜¯æˆ‘çš„å­¦ç”Ÿã€‚":"tÄ shÃ¬ wÇ’ de xuÃ© sheng ã€‚",
    "å»çœ‹åŒ»ç”Ÿå§ã€‚":"qÃ¹ kÃ n yÄ« shÄ“ng ba ã€‚", "å­¦æ ¡å¾ˆå¤§ã€‚":"xuÃ© xiÃ o hÄ›n dÃ  ã€‚",
    "ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚":"nÇ hÇo ï¼Œ hÄ›n gÄo xÃ¬ng rÃ¨n shi nÇ ã€‚", "æˆ‘ä¹Ÿå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚":"wÇ’ yÄ› hÄ›n gÄo xÃ¬ng rÃ¨n shi nÇ ã€‚",
    "è°¢è°¢ä½ ã€‚":"xiÃ¨ xie nÇ ã€‚", "ä¸å®¢æ°”ã€‚":"bÃº kÃ¨ qi ã€‚", "å†è§ï¼Œæ˜å¤©è§ã€‚":"zÃ i jiÃ n ï¼Œ mÃ­ng tiÄn jiÃ n ã€‚",
    "æ˜å¤©è§ã€‚":"mÃ­ng tiÄn jiÃ n ã€‚", "è¿™ä¸ªæ¯å­å¤šå°‘é’±ï¼Ÿ":"zhÃ¨ gÃ¨ bÄ“i zi duÅ shao qiÃ¡n ï¼Ÿ",
    "äºŒåå—é’±ã€‚":"Ã¨r shÃ­ kuÃ i qiÃ¡n ã€‚", "ä»Šå¤©æ˜ŸæœŸå‡ ï¼Ÿ":"jÄ«n tiÄn xÄ«ng qÄ« jÇ ï¼Ÿ", "ä»Šå¤©æ˜ŸæœŸä¸‰ã€‚":"jÄ«n tiÄn xÄ«ng qÄ« sÄn ã€‚",
    "ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ":"nÇ jiÃ o shÃ©n me mÃ­ng zi ï¼Ÿ", "æˆ‘å«ç‹å°æ˜ã€‚":"wÇ’ jiÃ o WÃ¡ng XiÇo mÃ­ng ã€‚",
    "ä½ åœ¨åšä»€ä¹ˆå‘¢ï¼Ÿ":"nÇ zÃ i zuÃ² shÃ©n me ne ï¼Ÿ", "æˆ‘åœ¨çœ‹ç”µè§†å‘¢ã€‚":"wÇ’ zÃ i kÃ n diÃ n shÃ¬ ne ã€‚",
    "ä½ ä¼šè¯´æ±‰è¯­å—ï¼Ÿ":"nÇ huÃ¬ shuÅ HÃ n yÇ” ma ï¼Ÿ", "æˆ‘ä¼šè¯´ä¸€ç‚¹å„¿ã€‚":"wÇ’ huÃ¬ shuÅ yÄ« diÇnr ã€‚",
    "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ":"xiÃ n zÃ i jÇ diÇn le ï¼Ÿ", "ä¸‹åˆä¸‰ç‚¹åŠã€‚":"xiÃ  wÇ” sÄn diÇn bÃ n ã€‚",
    "ä½ åœ¨å“ªå„¿ï¼Ÿ":"nÇ zÃ i nÇr ï¼Ÿ", "æˆ‘åœ¨å•†åº—é‡Œã€‚":"wÇ’ zÃ i shÄng diÃ n lÇ ã€‚",
    "é‚£æ˜¯ä½ çš„çŒ«å—ï¼Ÿ":"nÃ  shÃ¬ nÇ de mÄo ma ï¼Ÿ", "æ˜¯çš„ï¼Œé‚£æ˜¯æˆ‘çš„ã€‚":"shÃ¬ de ï¼Œ nÃ  shÃ¬ wÇ’ de ã€‚",
    "å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ":"tiÄn qÃ¬ zÄ›n me yÃ ng ï¼Ÿ", "å¤ªçƒ­äº†ã€‚":"tÃ i rÃ¨ le ã€‚",
    "ä½ æ˜¯å“ªå›½äººï¼Ÿ":"nÇ shÃ¬ nÇ guÃ³ rÃ©n ï¼Ÿ", "æˆ‘æ˜¯ä¸­å›½äººã€‚":"wÇ’ shÃ¬ ZhÅng guÃ³ rÃ©n ã€‚",
    "ä»–å¤šå¤§äº†ï¼Ÿ":"tÄ duÅ dÃ  le ï¼Ÿ", "ä»–äº”å²äº†ã€‚":"tÄ wÇ” suÃ¬ le ã€‚",
    "ä½ è¦å–ç‚¹å„¿æ°´å—ï¼Ÿ":"nÇ yÃ o hÄ“ diÇnr shuÇ ma ï¼Ÿ", "å¥½çš„ï¼Œè°¢è°¢ã€‚":"hÇo de ï¼Œ xiÃ¨ xie ã€‚",
    "è°åœ¨æˆ¿é—´é‡Œï¼Ÿ":"shÃ©i zÃ i fÃ¡ng jiÄn lÇ ï¼Ÿ", "æ˜¯æˆ‘çš„è€å¸ˆã€‚":"shÃ¬ wÇ’ de lÇo shÄ« ã€‚",
    "ä½ ä¼šåšé¥­å—ï¼Ÿ":"nÇ huÃ¬ zuÃ² fÃ n ma ï¼Ÿ", "æˆ‘ä¸ä¼šã€‚":"wÇ’ bÃº huÃ¬ ã€‚",
    "åŒ—äº¬å¤§å—ï¼Ÿ":"BÄ›i jÄ«ng dÃ  ma ï¼Ÿ", "åŒ—äº¬å¾ˆå¤§ã€‚":"BÄ›i jÄ«ng hÄ›n dÃ  ã€‚",
    "ä½ æƒ³å»å“ªå„¿ï¼Ÿ":"nÇ xiÇng qÃ¹ nÇr ï¼Ÿ", "æˆ‘æƒ³å»é¥­åº—ã€‚":"wÇ’ xiÇng qÃ¹ fÃ n diÃ n ã€‚",
    "ä½ ä¼šå†™æ±‰å­—å—ï¼Ÿ":"nÇ huÃ¬ xiÄ› hÃ n zÃ¬ ma ï¼Ÿ", "æˆ‘ä¼šå†™ã€‚":"wÇ’ huÃ¬ xiÄ› ã€‚",
    "æˆ‘å____å»åŒ—äº¬ã€‚":"wÇ’ zuÃ² ____ qÃ¹ BÄ›i jÄ«ng ã€‚", "ä½ æƒ³____ä»€ä¹ˆï¼Ÿ":"nÇ xiÇng ____ shÃ©n me ï¼Ÿ",
    "ä»–æ˜¯æˆ‘çš„____ã€‚":"tÄ shÃ¬ wÇ’ de ____ ã€‚", "å¤–é¢____äº†ï¼Œåˆ«å‡ºå»ã€‚":"wÃ i miÃ n ____ le ï¼Œ biÃ© chÅ« qÃ¹ ã€‚",
    "ç°åœ¨____ç‚¹é’Ÿï¼Ÿ":"xiÃ n zÃ i ____ diÇn zhÅng ï¼Ÿ", "æˆ‘ä¼šè¯´____æ±‰è¯­ã€‚":"wÇ’ huÃ¬ shuÅ ____ HÃ n yÇ” ã€‚",
    "è¯·åï¼Œè¯·____èŒ¶ã€‚":"qÇng zuÃ² ï¼Œ qÇng ____ chÃ¡ ã€‚", "è¿™ä¸ªæ¯å­ä¸‰å____ã€‚":"zhÃ¨ gÃ¨ bÄ“i zi sÄn shÃ­ ____ ã€‚",
    "ä»–åœ¨____å·¥ä½œã€‚":"tÄ zÃ i ____ gÅng zuÃ² ã€‚", "é‚£ä¸ªå­—æ€ä¹ˆ____ï¼Ÿ":"nÃ  gÃ¨ zÃ¬ zÄ›n me ____ ï¼Ÿ",
    "æˆ‘ä¸____ä»–ã€‚":"wÇ’ bÃ¹ ____ tÄ ã€‚", "æ˜å¤©æœ‰____ã€‚":"mÃ­ng tiÄn yÇ’u ____ ã€‚",
    "æ¡Œå­____æœ‰ä¸€æœ¬ä¹¦ã€‚":"zhuÅ zi ____ yÇ’u yÄ« bÄ›n shÅ« ã€‚", "ä½ ____å²äº†ï¼Ÿ":"nÇ ____ suÃ¬ le ï¼Ÿ",
    "æˆ‘æƒ³å»____ä¹°ä¸œè¥¿ã€‚":"wÇ’ xiÇng qÃ¹ ____ mÇi dÅng xi ã€‚", "é‚£ä¸ªè¡£æœå¤ª____äº†ã€‚":"nÃ  gÃ¨ yÄ« fu tÃ i ____ le ã€‚",
    "ä½ ____ä»€ä¹ˆåå­—ï¼Ÿ":"nÇ ____ shÃ©n me mÃ­ng zi ï¼Ÿ", "çˆ¸çˆ¸åœ¨____å‘¢ã€‚":"bÃ  ba zÃ i ____ ne ã€‚",
    "ä½ ä¼š____æ±‰è¯­å—ï¼Ÿ":"nÇ huÃ¬ ____ HÃ n yÇ” ma ï¼Ÿ", "å¾ˆé«˜å…´____ä½ ã€‚":"hÄ›n gÄo xÃ¬ng ____ nÇ ã€‚",
    "é£æœº":"fÄ“i jÄ«", "ç”µè„‘":"diÃ n nÇo", "æ¡Œå­":"zhuÅ zi", "è‹¹æœ":"pÃ­ng guÇ’", "å–":"hÄ“", "çœ‹":"kÃ n", "è¯´":"shuÅ", "å»":"qÃ¹",
    "è€å¸ˆ":"lÇo shÄ«", "å¤©æ°”":"tiÄn qÃ¬", "æ¤…å­":"yÇ zi", "åå­—":"mÃ­ng zi", "ä¸‹é›¨":"xiÃ  yÇ”", "è¯´è¯":"shuÅ huÃ ", "çœ‹ä¹¦":"kÃ n shÅ«", "ç¡è§‰":"shuÃ¬ jiÃ o",
    "å‡ ":"jÇ", "å¤š":"duÅ", "ä»€ä¹ˆ":"shÃ©n me", "å“ªå„¿":"nÇr", "ä¸€ç‚¹å„¿":"yÄ« diÇnr", "ä¸€äº›":"yÄ« xiÄ“", "å‡ ä¸ª":"jÇ gÃ¨", "å¤šå°‘":"duÅ shao",
    "ä¹°":"mÇi", "å«":"jiÃ o", "å—":"kuÃ i", "æœˆ":"yuÃ¨", "å·":"hÃ o", "å¹´":"niÃ¡n", "åŒ»é™¢":"yÄ« yuÃ n", "è¯»":"dÃº", "å¬":"tÄ«ng",
    "è®¤è¯†":"rÃ¨n shi", "æ¼‚äº®":"piÃ o liang", "å¯¹ä¸èµ·":"duÃ¬ bÃ¹ qÇ", "æ²¡å…³ç³»":"mÃ©i guÄn xi", "ç”µå½±":"diÃ n yÇng", "å†è§":"zÃ i jiÃ n", "è°¢è°¢":"xiÃ¨ xie",
    "ä¸Š":"shÃ ng", "å":"hÃ²u", "å‰":"qiÃ¡n", "é‡Œ":"lÇ", "é‚£":"nÃ ", "å•†åº—":"shÄng diÃ n", "åŒ»ç”Ÿ":"yÄ« shÄ“ng", "ä¼š":"huÃ¬", "å†™":"xiÄ›", "æƒ³":"xiÇng", "åˆ†é’Ÿ":"fÄ“n zhÅng", "é’±":"qiÃ¡n", "ä¸å®¢æ°”":"bÃº kÃ¨ qi", "å¾ˆæ¼‚äº®":"hÄ›n piÃ o liang", "æ²¡å»åŒ»é™¢":"mÃ©i qÃ¹ yÄ« yuÃ n"
};

const vocab = [
    {c:"åŒ»ç”Ÿ", e:"ğŸ‘¨â€âš•ï¸"}, {c:"è‹¹æœ", e:"ğŸ"}, {c:"å–èŒ¶", e:"â˜•"}, {c:"çœ‹ä¹¦", e:"ğŸ“–"}, {c:"å°çŒ«", e:"ğŸ±"}, 
    {c:"ç”µè„‘", e:"ğŸ’»"}, {c:"é£æœº", e:"âœˆï¸"}, {c:"å‡ºç§Ÿè½¦", e:"ğŸš•"}, {c:"è¡£æœ", e:"ğŸ‘•"}, {c:"ä¸‹é›¨", e:"ğŸŒ§ï¸"},
    {c:"è€å¸ˆ", e:"ğŸ‘©â€ğŸ«"}, {c:"å­¦ç”Ÿ", e:"ğŸ§’"}, {c:"æ¡Œå­", e:"ğŸª‘"}, {c:"æ°´æœ", e:"ğŸ‡"}, {c:"æ¤…å­", e:"ğŸ’º"},
    {c:"å•†åº—", e:"ğŸª"}, {c:"é¥­åº—", e:"ğŸ±"}, {c:"å­¦æ ¡", e:"ğŸ«"}, {c:"åŒ»é™¢", e:"ğŸ¥"}, {c:"ç”µå½±", e:"ğŸ¬"}
];

const questions = [];
let currentIdx = 0;
let partScores = [0, 0, 0, 0];
let mistakes = JSON.parse(localStorage.getItem('hsk1_reading_err') || '[]');
let isMistakeMode = false;

// æ ¸å¿ƒï¼šæ¨ªæ’å¯¹é½è½¬æ¢å‡½æ•°
function toRuby(text) {
    if (!text) return "";
    const pyStr = pinyinMap[text];
    if (!pyStr) return text;

    const chars = text.split('');
    const pyArray = pyStr.split(' ');
    
    let result = "";
    let pyIdx = 0;
    
    for (let char of chars) {
        if (/[\u4e00-\u9fa5]/.test(char) || (char === "_" && pyArray[pyIdx] === "____")) {
            let p = pyArray[pyIdx] || "";
            result += `<ruby>${char}<rt>${p}</rt></ruby>`;
            pyIdx++;
        } else if (char === " ") {
            result += " ";
        } else if (char === "_") {
            // å¤„ç†å¡«ç©ºæ¨ªçº¿
            result += char;
        } else {
            // æ ‡ç‚¹ç¬¦å·
            result += `<ruby>${char}<rt>&nbsp;</rt></ruby>`;
            pyIdx++;
        }
    }
    return result;
}

function buildDatabase() {
    for(let i=0; i<20; i++) {
        let isTrue = Math.random() > 0.5;
        questions.push({ id:i, type:1, text: vocab[i].c, visual: isTrue?vocab[i].e:vocab[(i+5)%20].e, answer:isTrue, title:`è¯æ±‡åˆ¤æ–­` });
    }
    const p2data = [
        {s:"ä»–åœ¨ä¹¦åº—çœ‹ä¹¦ã€‚", a:"ğŸ“–"}, {s:"æˆ‘æƒ³åƒä¸€ä¸ªè‹¹æœã€‚", a:"ğŸ"}, {s:"å¤–é¢ä¸‹é›¨äº†ã€‚", a:"ğŸŒ§ï¸"},
        {s:"æˆ‘åé£æœºå»åŒ—äº¬ã€‚", a:"âœˆï¸"}, {s:"æè€å¸ˆåœ¨å­¦æ ¡ã€‚", a:"ğŸ‘©â€ğŸ«"}, {s:"å¥¹æœ‰ä¸€åªå°çŒ«ã€‚", a:"ğŸ±"},
        {s:"æˆ‘æƒ³å–ä¸€ç‚¹å„¿èŒ¶ã€‚", a:"â˜•"}, {s:"ä»–åœ¨æ¡Œå­ä¸‹é¢ã€‚", a:"ğŸª‘"}, {s:"æˆ‘å»å•†åº—ä¹°è¡£æœã€‚", a:"ğŸ‘•"},
        {s:"å¥¹åœ¨åŒ»é™¢å·¥ä½œã€‚", a:"ğŸ¥"}, {s:"è¯·ååœ¨æ¤…å­ä¸Šã€‚", a:"ğŸ’º"}, {s:"ä»Šå¤©æœ‰å¤§é›¨ã€‚", a:"ğŸŒ§ï¸"},
        {s:"è¿™æ˜¯æˆ‘çš„ç”µè„‘ã€‚", a:"ğŸ’»"}, {s:"æˆ‘æƒ³çœ‹ç”µå½±ã€‚", a:"ğŸ¬"}, {s:"é¥­åº—é‡Œæœ‰å¾ˆå¤šäººã€‚", a:"ğŸ±"},
        {s:"ä»–åœ¨æ‰“å‡ºç§Ÿè½¦ã€‚", a:"ğŸš•"}, {s:"è¿™ä¸ªæ°´æœå¾ˆå¥½åƒã€‚", a:"ğŸ‡"}, {s:"å¥¹æ˜¯æˆ‘çš„å­¦ç”Ÿã€‚", a:"ğŸ§’"},
        {s:"å»çœ‹åŒ»ç”Ÿå§ã€‚", a:"ğŸ‘¨â€âš•ï¸"}, {s:"å­¦æ ¡å¾ˆå¤§ã€‚", a:"ğŸ«"}
    ];
    p2data.forEach((d, i) => {
        let opts = [d.a, "ğŸš—", "ğŸ ", "ğŸ¥¤"].sort(()=>Math.random()-0.5);
        questions.push({ id:i+20, type:2, text:d.s, options:opts, answer:opts.indexOf(d.a), title:`å¥å­é€‰å›¾` });
    });
    const p3data = [
        {q:"ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚", a:"æˆ‘ä¹Ÿå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚"}, {q:"è°¢è°¢ä½ ã€‚", a:"ä¸å®¢æ°”ã€‚"},
        {q:"å†è§ï¼Œæ˜å¤©è§ã€‚", a:"æ˜å¤©è§ã€‚"}, {q:"è¿™ä¸ªæ¯å­å¤šå°‘é’±ï¼Ÿ", a:"äºŒåå—é’±ã€‚"},
        {q:"ä»Šå¤©æ˜ŸæœŸå‡ ï¼Ÿ", a:"ä»Šå¤©æ˜ŸæœŸä¸‰ã€‚"}, {q:"ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ", a:"æˆ‘å«ç‹å°æ˜ã€‚"},
        {q:"ä½ åœ¨åšä»€ä¹ˆå‘¢ï¼Ÿ", a:"æˆ‘åœ¨çœ‹ç”µè§†å‘¢ã€‚"}, {q:"ä½ ä¼šè¯´æ±‰è¯­å—ï¼Ÿ", a:"æˆ‘ä¼šè¯´ä¸€ç‚¹å„¿ã€‚"},
        {q:"ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ", a:"ä¸‹åˆä¸‰ç‚¹åŠã€‚"}, {q:"ä½ åœ¨å“ªå„¿ï¼Ÿ", a:"æˆ‘åœ¨å•†åº—é‡Œã€‚"},
        {q:"é‚£æ˜¯ä½ çš„çŒ«å—ï¼Ÿ", a:"æ˜¯çš„ï¼Œé‚£æ˜¯æˆ‘çš„ã€‚"}, {q:"å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ", a:"å¤ªçƒ­äº†ã€‚"},
        {q:"ä½ æ˜¯å“ªå›½äººï¼Ÿ", a:"æˆ‘æ˜¯ä¸­å›½äººã€‚"}, {q:"ä»–å¤šå¤§äº†ï¼Ÿ", a:"ä»–äº”å²äº†ã€‚"},
        {q:"ä½ è¦å–ç‚¹å„¿æ°´å—ï¼Ÿ", a:"å¥½çš„ï¼Œè°¢è°¢ã€‚"}, {q:"è°åœ¨æˆ¿é—´é‡Œï¼Ÿ", a:"æ˜¯æˆ‘çš„è€å¸ˆã€‚"},
        {q:"ä½ ä¼šåšé¥­å—ï¼Ÿ", a:"æˆ‘ä¸ä¼šã€‚"}, {q:"åŒ—äº¬å¤§å—ï¼Ÿ", a:"åŒ—äº¬å¾ˆå¤§ã€‚"},
        {q:"ä½ æƒ³å»å“ªå„¿ï¼Ÿ", a:"æˆ‘æƒ³å»é¥­åº—ã€‚"}, {q:"ä½ ä¼šå†™æ±‰å­—å—ï¼Ÿ", a:"æˆ‘ä¼šå†™ã€‚"}
    ];
    p3data.forEach((d, i) => {
        let opts = [d.a, "æ²¡å…³ç³»ã€‚", "å¾ˆæ¼‚äº®ã€‚", "æ²¡å»åŒ»é™¢ã€‚"].sort(()=>Math.random()-0.5);
        questions.push({ id:i+40, type:3, text:d.q, options:opts, answer:opts.indexOf(d.a), title:`å¯¹è¯é…å¯¹` });
    });
    const p4data = [
        {s:"æˆ‘å____å»åŒ—äº¬ã€‚", o:["é£æœº", "ç”µè„‘", "æ¡Œå­", "è‹¹æœ"], a:0},
        {s:"ä½ æƒ³____ä»€ä¹ˆï¼Ÿ", o:["å–", "çœ‹", "è¯´", "å»"], a:0},
        {s:"ä»–æ˜¯æˆ‘çš„____ã€‚", o:["è€å¸ˆ", "å¤©æ°”", "æ¤…å­", "åå­—"], a:0},
        {s:"å¤–é¢____äº†ï¼Œåˆ«å‡ºå»ã€‚", o:["ä¸‹é›¨", "è¯´è¯", "çœ‹ä¹¦", "ç¡è§‰"], a:0},
        {s:"ç°åœ¨____ç‚¹é’Ÿï¼Ÿ", o:["å‡ ", "å¤š", "ä»€ä¹ˆ", "å“ªå„¿"], a:0},
        {s:"æˆ‘ä¼šè¯´____æ±‰è¯­ã€‚", o:["ä¸€ç‚¹å„¿", "ä¸€äº›", "å‡ ä¸ª", "å¤šå°‘"], a:0},
        {s:"è¯·åï¼Œè¯·____èŒ¶ã€‚", o:["å–", "åƒ", "ä¹°", "å«"], a:0},
        {s:"è¿™ä¸ªæ¯å­ä¸‰å____ã€‚", o:["å—", "æœˆ", "å·", "å¹´"], a:0},
        {s:"ä»–åœ¨____å·¥ä½œã€‚", o:["åŒ»é™¢", "è¡£æœ", "æ°´æœ", "ç”µè„‘"], a:0},
        {s:"é‚£ä¸ªå­—æ€ä¹ˆ____ï¼Ÿ", o:["è¯»", "å¬", "å–", "å«"], a:0},
        {s:"æˆ‘ä¸____ä»–ã€‚", o:["è®¤è¯†", "æ¼‚äº®", "å¯¹ä¸èµ·", "æ²¡å…³ç³»"], a:0},
        {s:"æ˜å¤©æœ‰____ã€‚", o:["ç”µå½±", "å†è§", "è°¢è°¢", "åå­—"], a:0},
        {s:"æ¡Œå­____æœ‰ä¸€æœ¬ä¹¦ã€‚", o:["ä¸Š", "å", "å‰", "é‡Œ"], a:0},
        {s:"ä½ ____å²äº†ï¼Ÿ", o:["å‡ ", "å¤š", "ä»€ä¹ˆ", "é‚£"], a:0},
        {s:"æˆ‘æƒ³å»____ä¹°ä¸œè¥¿ã€‚", o:["å•†åº—", "å¤©æ°”", "åŒ»ç”Ÿ", "è¡£æœ"], a:0},
        {s:"é‚£ä¸ªè¡£æœå¤ª____äº†ã€‚", o:["æ¼‚äº®", "è®¤è¯†", "ä¼š", "å«"], a:0},
        {s:"ä½ ____ä»€ä¹ˆåå­—ï¼Ÿ", o:["å«", "å†™", "çœ‹", "æƒ³"], a:0},
        {s:"çˆ¸çˆ¸åœ¨____å‘¢ã€‚", o:["ç¡è§‰", "åˆ†é’Ÿ", "é’±", "å“ªå„¿"], a:0},
        {s:"ä½ ä¼š____æ±‰è¯­å—ï¼Ÿ", o:["è¯´", "å–", "åƒ", "å»"], a:0},
        {s:"å¾ˆé«˜å…´____ä½ ã€‚", o:["è®¤è¯†", "å¯¹ä¸èµ·", "ä¸å®¢æ°”", "å†è§"], a:0}
    ];
    p4data.forEach((d, i) => {
        questions.push({ id:i+60, type:4, text:d.s, options:d.o, answer:d.a, title:`é€‰è¯å¡«ç©º` });
    });
}

function startApp(idx) { 
    currentIdx = idx; isMistakeMode = false;
    document.getElementById('q-mode').style.display = 'none';
    document.getElementById('cover-page').style.transform = 'translateY(-100%)';
    document.getElementById('app').style.display = 'flex';
    renderQuestion(); 
}

function renderQuestion() {
    const q = isMistakeMode ? mistakes[currentIdx] : questions[currentIdx];
    document.getElementById('q-info').innerText = isMistakeMode ? `MISTAKE ${currentIdx+1}/${mistakes.length}` : `${q.title} ${(currentIdx%20)+1}/20`;
    document.getElementById('progress-fill').style.width = isMistakeMode ? `${(currentIdx+1)/mistakes.length*100}%` : `${((currentIdx%20)+1)/20*100}%`;
    
    document.getElementById('reading-text').innerHTML = toRuby(q.text);
    const grid = document.getElementById('options-grid');
    const visual = document.getElementById('visual-content');
    grid.innerHTML = ''; visual.style.display = (q.type===1)?'block':'none';
    
    if(q.type === 1) {
        visual.innerText = q.visual;
        grid.innerHTML = `<div class="opt-item" onclick="handleAnswer(true)">âœ”ï¸ Correct</div><div class="opt-item" onclick="handleAnswer(false)">âŒ Wrong</div>`;
    } else {
        q.options.forEach((o, i) => {
            const content = q.type === 2 ? `<span class="opt-img">${o}</span>` : toRuby(o);
            grid.innerHTML += `<div class="opt-item" onclick="handleAnswer(${i})">${content}</div>`;
        });
    }
}

function handleAnswer(choice) {
    const q = isMistakeMode ? mistakes[currentIdx] : questions[currentIdx];
    const isCorrect = choice === q.answer;
    const fb = document.getElementById('feedback-pop');
    fb.innerText = isCorrect ? "âœ”ï¸" : "âŒ"; fb.style.color = isCorrect ? "#4cd137" : "#ff4757"; fb.style.display = 'block';

    if(isCorrect) {
        if(isMistakeMode) {
            mistakes.splice(currentIdx, 1);
            localStorage.setItem('hsk1_reading_err', JSON.stringify(mistakes));
        } else {
            partScores[Math.floor(currentIdx/20)]++;
        }
    } else {
        if(!isMistakeMode && !mistakes.some(m=>m.id===q.id)) {
            mistakes.push(q); localStorage.setItem('hsk1_reading_err', JSON.stringify(mistakes));
        }
    }

    setTimeout(() => {
        fb.style.display = 'none';
        if(isMistakeMode) {
            if(mistakes.length === 0) showSummary(true);
            else { if(currentIdx >= mistakes.length) currentIdx = 0; renderQuestion(); }
        } else {
            if((currentIdx + 1) % 20 === 0) showSummary(false);
            else { currentIdx++; renderQuestion(); }
        }
    }, 800);
}

function showSummary(fromMistake) {
    document.getElementById('summary-screen').style.display = 'flex';
    const sNum = document.getElementById('final-score');
    const pText = document.getElementById('praise-text');
    if(fromMistake) {
        document.getElementById('sum-title').innerText = "MISTAKES CLEARED!";
        sNum.innerText = "100";
        pText.innerText = "å¤ªæ£’äº†ï¼é˜…è¯»é”™é¢˜å…¨éƒ¨è§£å†³ï¼";
    } else {
        const s = partScores[Math.floor(currentIdx/20)];
        sNum.innerText = s * 5;
        pText.innerText = s > 15 ? "çœŸå‰å®³ï¼ä½ çš„é˜…è¯»æ°´å¹³å¾ˆæ£’ï¼" : "åšå¾—å¥½ï¼å¤šçœ‹å¤šè¯»ä¼šæ›´æ£’ã€‚";
    }
}

function toggleOverlay(id, show) {
    document.getElementById(id).style.display = show?'block':'none';
    if(show && id==='list-view') renderList();
    if(show && id==='mistake-view') renderMistakeList();
}

function renderList() {
    document.getElementById('list-content').innerHTML = questions.map((q, i) => 
        `<div class="list-card" onclick="jumpTo(${i}, false)"><span><b>${i+1}.</b> ${q.text.substring(0,10)}...</span><span style="color:var(--gold)">GO</span></div>`
    ).join('');
}

function renderMistakeList() {
    const c = document.getElementById('mistake-content');
    if(!mistakes.length) { c.innerHTML="No mistakes!"; return; }
    c.innerHTML = mistakes.map((q, i) => 
        `<div class="list-card" onclick="jumpTo(${i}, true)"><span>${q.text.substring(0,10)}...</span><span style="color:var(--pinyin-red)">FIX</span></div>`
    ).join('');
}

function jumpTo(idx, isMistake) {
    currentIdx = idx; isMistakeMode = isMistake;
    toggleOverlay(isMistake ? 'mistake-view' : 'list-view', false);
    document.getElementById('q-mode').style.display = isMistake ? 'inline-block' : 'none';
    document.getElementById('cover-page').style.transform = 'translateY(-100%)';
    document.getElementById('app').style.display = 'flex';
    renderQuestion();
}

function nextQuestion() { if(!isMistakeMode && (currentIdx+1)%20!==0) { currentIdx++; renderQuestion(); } }
function prevQuestion() { if(!isMistakeMode && currentIdx%20!==0) { currentIdx--; renderQuestion(); } }
function exitToCover() { document.getElementById('cover-page').style.transform = 'translateY(0)'; }

window.onload = buildDatabase;
</script>
</body>
</html>