<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>XUSFUNCHINESE - HSK1 Writing Mode üèÆ</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root { 
            --pinyin-red: #d63031; 
            --paper: rgba(255, 255, 255, 0.95); 
            --gold: #fbc02d; 
            --accent: #218c74; 
            --primary: #01579b;
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
            --gray: #ccc;
        }
        body { 
            margin: 0; font-family: "Arial Black", sans-serif; 
            background: linear-gradient(135deg, #0277bd 0%, #002f6c 100%); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        /* Cover */
        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--night-sky); z-index: 5000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s; cursor: pointer;
        }
        .shiny-title {
            font-size: 8vw; font-weight: 900; text-align: center;
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
            animation: shine 3s infinite linear;
        }
        @keyframes shine { 0% { background-position: 0%; } 100% { background-position: 200%; } }

        /* Header */
        header { background: var(--paper); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 100; }
        .nav-btns button { padding: 8px 15px; margin-right: 5px; border-radius: 20px; border: 2px solid var(--primary); cursor: pointer; font-weight: bold; background: white; color: var(--primary); }
        .active-btn { background: var(--primary) !important; color: white !important; }

        main { flex: 1; display: flex; padding: 20px; gap: 20px; overflow: hidden; }
        #left-panel { 
            flex: 1; background: var(--paper); border-radius: 30px; display: flex; flex-direction: column; 
            align-items: center; justify-content: flex-start; position: relative; border: 5px solid var(--gold);
            padding: 15px 20px 20px 20px; box-sizing: border-box;
        }
        #right-panel { flex: 1; background: var(--paper); border-radius: 30px; padding: 20px; overflow-y: auto; border: 5px solid var(--gold); }

        /* Writing area - Âº∫Âà∂Ê®™ÂêëÊéíÂàó */
        #writer-container { 
            display: flex; flex-direction: row; justify-content: center; align-items: center;
            gap: 15px; padding: 10px 0; width: 100%; overflow-x: auto; overflow-y: hidden;
            scrollbar-width: none;
        }
        #writer-container::-webkit-scrollbar { display: none; }
        .char-writer { 
            flex: 0 0 240px; width: 240px; height: 240px; background: white; border: 2px solid #ccc; 
            touch-action: none; position: relative; cursor: pointer;
        }
        .char-writer.inactive { opacity: 0.4; filter: grayscale(80%); } /* Êú™ÊºîÁ§∫ÁöÑÂ≠óÁÅ∞Ëâ≤ */
        .char-writer.active { border: 4px solid var(--gold); } /* ÂΩìÂâçÊºîÁ§∫È´ò‰∫Æ */
        
        .pinyin { 
            font-size: 28px; color: var(--pinyin-red); font-weight: bold; margin: 0 0 10px 0; 
            text-align: center; max-width: 95%; word-wrap: break-word;
        }
        .meaning { 
            font-size: 20px; color: #555; margin: 0 0 15px 0; text-align: center; 
            max-width: 95%; word-wrap: break-word;
        }

        .list-card { background: white; margin-bottom: 10px; padding: 15px; border-radius: 15px; display: flex; align-items: center; cursor: pointer; border-left: 8px solid var(--primary); transition: 0.2s; }
        .list-card:hover { transform: translateX(10px); background: var(--accent); color: white; }
        .list-char { font-size: 30px; min-width: 80px; text-align: center; }
        
        #hint-area { font-size: 18px; color: var(--primary); margin: 10px 0; font-weight: bold; height: 25px; text-align: center; }
        .watermark { position: fixed; bottom: 10px; right: 20px; color: rgba(255,255,255,0.3); font-style: italic; pointer-events: none; }

        .mode-desc { margin-top: 10px; font-size: 16px; color: #333; text-align: center; max-width: 85%; }

        .button-area {
            margin-top: 20px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
            width: 100%; box-sizing: border-box;
        }
    </style>
</head>
<body>

<div id="cover-page" onclick="enterApp()">
    <div class="shiny-title">HSK 1<br>WRITING MODE</div>
    <p style="color:white; margin-top:20px; letter-spacing:3px;">CLICK TO START</p>
</div>

<div class="watermark">XUSFUNCHINESE</div>

<header>
    <div class="nav-btns">
        <button id="btn-learn" onclick="switchMode('learn')" class="active-btn">üìñ Learn</button>
        <button id="btn-test" onclick="switchMode('test')">üìù Practice</button>
        <button id="btn-quiz" onclick="switchMode('quiz')">‚ùì Quiz</button>
        <button id="btn-list" onclick="switchMode('list')">üìú List</button>
        <button id="btn-wrong" onclick="switchMode('wrong')">‚ùå Mistakes</button>
    </div>
    <div style="font-weight:bold; color:var(--primary)">HSK1 Writing - <span id="progress">1</span>/150</div>
</header>

<main>
    <div id="left-panel">
        <div id="pinyin-display" class="pinyin"></div>
        <div id="writer-container"></div>
        <div id="meaning-display" class="meaning"></div>
        <div id="hint-area"></div>
        <div class="mode-desc" id="mode-description"></div>
        <div class="button-area">
            <button onclick="prevItem()" style="padding:10px 20px; border-radius:10px;">Previous</button>
            <button onclick="showHint()" id="hint-btn" style="padding:10px 20px; border-radius:10px; background:var(--gold); border:none; font-weight:bold;">Show Hint</button>
            <button onclick="nextItem()" style="padding:10px 20px; border-radius:10px;">Next</button>
        </div>
    </div>

    <div id="right-panel">
        <div id="list-view" style="display:none;"></div>
        <div id="wrong-view" style="display:none;"></div>
        <div id="info-view" style="display:block;">
            <h3 id="info-title">Mode Guide</h3>
            <p id="info-text"></p>
            <div id="stats" style="margin-top:30px; padding:20px; background:var(--accent); color:white; border-radius:20px;">
                Mastery Progress: <span id="stat-done">0</span> / 150
            </div>
        </div>
    </div>
</main>

<script>
const vocabulary = [
    {c:"Êàë", p:"w«í", m:"I, me"}, {c:"‰Ω†", p:"n«ê", m:"you"}, {c:"‰ªñ", p:"tƒÅ", m:"he, him"},
    {c:"Â•π", p:"tƒÅ", m:"she, her"}, {c:"‰ª¨", p:"men", m:"plural suffix"}, {c:"Â•Ω", p:"h«éo", m:"good, well"},
    {c:"ÊòØ", p:"sh√¨", m:"be, is, am, are"}, {c:"‰∏ç", p:"b√π", m:"not, no"}, {c:"Âêó", p:"ma", m:"question particle"},
    {c:"Âæà", p:"hƒõn", m:"very"}, {c:"Âë¢", p:"ne", m:"modal particle"}, {c:"‰πü", p:"yƒõ", m:"also, too"},
    {c:"Â§ß", p:"d√†", m:"big"}, {c:"Â∞è", p:"xi«éo", m:"small"}, {c:"Â§ö", p:"du≈ç", m:"many, much"},
    {c:"Â∞ë", p:"sh«éo", m:"few, little"}, {c:"ÂÆ∂", p:"jiƒÅ", m:"home, family"}, {c:"Êúâ", p:"y«íu", m:"have"},
    {c:"Âè£", p:"k«íu", m:"mouth (measure word)"}, {c:"ÂÑø", p:"√©r", m:"son"}, {c:"Â≠ê", p:"z«ê", m:"child"},
    {c:"Âéª", p:"q√π", m:"go"}, {c:"Áúã", p:"k√†n", m:"look, watch"}, {c:"Âê¨", p:"tƒ´ng", m:"listen"},
    {c:"ËØ¥", p:"shu≈ç", m:"speak"}, {c:"ËØª", p:"d√∫", m:"read"}, {c:"ÂÜô", p:"xiƒõ", m:"write"},
    {c:"Âè´", p:"ji√†o", m:"call, be named"}, {c:"Âêç", p:"m√≠ng", m:"name"}, {c:"Â≠ó", p:"z√¨", m:"character"},
    {c:"Â≤Å", p:"su√¨", m:"year of age"}, {c:"Êúà", p:"yu√®", m:"month, moon"}, {c:"Êó•", p:"r√¨", m:"day, sun"},
    {c:"Â§©", p:"tiƒÅn", m:"day, sky"}, {c:"Âπ¥", p:"ni√°n", m:"year"}, {c:"Âùê", p:"zu√≤", m:"sit"},
    {c:"ËØ∑", p:"q«êng", m:"please"}, {c:"Ë∞¢", p:"xi√®", m:"thank"}, {c:"ËßÅ", p:"ji√†n", m:"see"},
    {c:"Ê≤°", p:"m√©i", m:"not have"}, {c:"ÂÖ≥", p:"guƒÅn", m:"close, relation"}, {c:"Á≥ª", p:"x√¨", m:"system, relation"},
    {c:"Ê±â", p:"h√†n", m:"Chinese (Han)"}, {c:"ËØ≠", p:"y«î", m:"language"}, {c:"Â≠¶", p:"xu√©", m:"study"},
    {c:"Ê†°", p:"xi√†o", m:"school"}, {c:"Áîü", p:"shƒìng", m:"student"}, {c:"ËÄÅ", p:"l«éo", m:"old"},
    {c:"Â∏à", p:"shƒ´", m:"teacher"}, {c:"Ë∞Å", p:"sh√©i", m:"who"},
    {c:"Ëøô", p:"zh√®", m:"this"}, {c:"ÈÇ£", p:"n√†", m:"that"}, {c:"ÁöÑ", p:"de", m:"possessive particle"},
    {c:"Âú®", p:"z√†i", m:"at, in"}, {c:"‰∫∫", p:"r√©n", m:"person"}, {c:"‰∏Ä", p:"yƒ´", m:"one"},
    {c:"‰∫å", p:"√®r", m:"two"}, {c:"‰∏â", p:"sƒÅn", m:"three"}, {c:"Âõõ", p:"s√¨", m:"four"},
    {c:"‰∫î", p:"w«î", m:"five"}, {c:"ÂÖ≠", p:"li√π", m:"six"}, {c:"‰∏É", p:"qƒ´", m:"seven"},
    {c:"ÂÖ´", p:"bƒÅ", m:"eight"}, {c:"‰πù", p:"ji«î", m:"nine"}, {c:"ÂçÅ", p:"sh√≠", m:"ten"},
    {c:"‰∏™", p:"g√®", m:"general measure word"}, {c:"‰∏ä", p:"sh√†ng", m:"above, up"}, {c:"‰∏ã", p:"xi√†", m:"below, down"},
    {c:"Èáå", p:"l«ê", m:"inside"}, {c:"Êù•", p:"l√°i", m:"come"}, {c:"Âõû", p:"hu√≠", m:"return"},
    {c:"‰ºö", p:"hu√¨", m:"can, will"}, {c:"Áà±", p:"√†i", m:"love"}, {c:"Áà∏", p:"b√†", m:"dad"},
    {c:"Â¶à", p:"mƒÅ", m:"mom"}, {c:"Âèã", p:"y«íu", m:"friend"}, {c:"ÊúãÂèã", p:"p√©ngyou", m:"friend"},
    {c:"Áî∑", p:"n√°n", m:"male"}, {c:"Â•≥", p:"n«ö", m:"female"}, {c:"‰∏≠ÂõΩ", p:"Zh≈çnggu√≥", m:"China"},
    {c:"Âåó‰∫¨", p:"Bƒõijƒ´ng", m:"Beijing"}, {c:"Áé∞Âú®", p:"xi√†nz√†i", m:"now"}, {c:"‰ªÄ‰πà", p:"sh√©nme", m:"what"},
    {c:"Âá†", p:"j«ê", m:"how many"}, {c:"ÁÇπ", p:"di«én", m:"o'clock, point"}, {c:"ÂàÜ", p:"fƒìn", m:"minute"},
    {c:"Êó∂Èó¥", p:"sh√≠jiƒÅn", m:"time"}, {c:"‰ªäÂ§©", p:"jƒ´ntiƒÅn", m:"today"}, {c:"ÊòéÂ§©", p:"m√≠ngtiƒÅn", m:"tomorrow"},
    {c:"Êò®Â§©", p:"zu√≥tiƒÅn", m:"yesterday"}, {c:"ÊòüÊúü", p:"xƒ´ngqƒ´", m:"week"}, {c:"ÂêÉ", p:"chƒ´", m:"eat"},
    {c:"Âñù", p:"hƒì", m:"drink"}, {c:"Ê∞¥", p:"shu«ê", m:"water"}, {c:"È•≠", p:"f√†n", m:"rice, meal"},
    {c:"Ëèú", p:"c√†i", m:"dish, vegetable"}, {c:"ÂñúÊ¨¢", p:"x«êhuan", m:"like"}, {c:"È´òÂÖ¥", p:"gƒÅox√¨ng", m:"happy"},
    {c:"ÂÜçËßÅ", p:"z√†iji√†n", m:"goodbye"}, {c:"ÂØπ‰∏çËµ∑", p:"du√¨buq«ê", m:"sorry"}, {c:"Ê≤°ÂÖ≥Á≥ª", p:"m√©i guƒÅnxi", m:"it doesn't matter"},
    {c:"Â§öÂ∞ë", p:"du≈çshao", m:"how much/many"}, {c:"Èí±", p:"qi√°n", m:"money"}, {c:"Âùó", p:"ku√†i", m:"yuan (colloquial)"},
    {c:"‰π∞", p:"m«éi", m:"buy"}, {c:"‰∏úË•ø", p:"d≈çngxi", m:"thing"}, {c:"‰π¶", p:"sh≈´", m:"book"},
    {c:"Êú¨", p:"bƒõn", m:"volume (measure word for books)"}, {c:"ÁîµËßÜ", p:"di√†nsh√¨", m:"television"}, {c:"ÁîµÂΩ±", p:"di√†ny«êng", m:"movie"},
    {c:"ÁîµËÑë", p:"di√†nn«éo", m:"computer"}, {c:"ÊâãÊú∫", p:"sh«íujƒ´", m:"mobile phone"}, {c:"Áå´", p:"mƒÅo", m:"cat"},
    {c:"Áãó", p:"g«íu", m:"dog"}, {c:"È±º", p:"y√∫", m:"fish"}, {c:"ËΩ¶", p:"chƒì", m:"car"},
    {c:"Âá∫ÁßüËΩ¶", p:"ch≈´z≈´chƒì", m:"taxi"}, {c:"È£ûÊú∫", p:"fƒìijƒ´", m:"airplane"}, {c:"ÂåªÈô¢", p:"yƒ´yu√†n", m:"hospital"},
    {c:"ÂåªÁîü", p:"yƒ´shƒìng", m:"doctor"}, {c:"Â∑•‰Ωú", p:"g≈çngzu√≤", m:"work"}, {c:"ÂÖ¨Âè∏", p:"g≈çngsƒ´", m:"company"},
    {c:"ÂïÜÂ∫ó", p:"shƒÅngdi√†n", m:"shop"}, {c:"ÊºÇ‰∫Æ", p:"pi√†oliang", m:"beautiful"}, {c:"È´òÂÖ¥", p:"gƒÅox√¨ng", m:"happy"},
    {c:"Ë∞¢Ë∞¢", p:"xi√®xie", m:"thank you"}, {c:"‰∏çÂÆ¢Ê∞î", p:"b√π k√®qi", m:"you're welcome"}
];

let currentIndex = 0;
let currentMode = 'learn';
let writers = [];
let divs = [];
let wrongAnswers = [];
let hintShown = false;

const encouragements = [
    "Â§™Ê£í‰∫ÜÔºÅ", "ÈùûÂ∏∏Â•ΩÔºÅ", "ÂÜôÂæóÁúüÊ£íÔºÅ", "ÁªßÁª≠Âä†Ê≤πÔºÅ", "ÂÆåÁæéÔºÅ", "‰∫Ü‰∏çËµ∑ÔºÅ", "ÁúüËÅ™ÊòéÔºÅ", "‰ºòÁßÄÔºÅ", "Ê£íÊûÅ‰∫ÜÔºÅ", "Â§™ÂéâÂÆ≥‰∫ÜÔºÅ"
];

const modeDescriptions = {
    learn: "Watch the stroke order animation and listen to the pronunciation. Imitate the writing.",
    test: "Write the character from memory. The outline is shown. Correct writing advances automatically.",
    quiz: "Pure quiz: No outline or character shown at first. Click 'Show Hint' to reveal a faint outline."
};

function initWriters(chars, mode) {
    writers = [];
    divs = [];
    document.getElementById('writer-container').innerHTML = '';
    hintShown = false;

    const commonOptions = {
        width: 240,
        height: 240,
        padding: 5,
        strokeColor: '#01579b',
        drawingColor: '#d63031',
        drawingWidth: (mode === 'test' || mode === 'quiz') ? 28 : 18,
        outlineColor: '#ddd',
        radicalColor: '#1666c4'
    };

    const charArray = chars.split('');

    charArray.forEach((char, index) => {
        const div = document.createElement('div');
        div.className = 'char-writer';
        div.dataset.index = index;
        div.onclick = () => replaySingleChar(index);
        document.getElementById('writer-container').appendChild(div);
        divs.push(div);

        const options = {...commonOptions};

        if (mode === 'learn') {
            options.showCharacter = true;
            options.showOutline = true;
            // ÊâÄÊúâÂ≠óÂàùÂßãÁÅ∞Ëâ≤
            div.classList.add('inactive');
        } else if (mode === 'test') {
            options.showCharacter = false;
            options.showOutline = true;
        } else if (mode === 'quiz') {
            options.showCharacter = false;
            options.showOutline = false;
        }

        const writer = HanziWriter.create(div, char, options);
        writers.push(writer);

        if (mode === 'learn') {
            if (index === 0) {
                // ÂºÄÂßãÊºîÁ§∫Á¨¨‰∏Ä‰∏™Â≠ó
                setTimeout(() => startSequentialAnimation(0), 600);
            }
        } else {
            let completed = 0;
            writer.quiz({
                onComplete: () => {
                    completed++;
                    if (completed === writers.length) {
                        const msg = encouragements[Math.floor(Math.random() * encouragements.length)];
                        document.getElementById('hint-area').innerText = msg + " üåü";
                        speak(msg);
                        speak(vocabulary[currentIndex].c);
                        setTimeout(nextItem, 2000);
                    }
                },
                onMistake: () => {
                    const currentObj = vocabulary[currentIndex];
                    if (!wrongAnswers.includes(currentObj)) wrongAnswers.push(currentObj);
                    document.getElementById('hint-area').innerText = "Try again~";
                    updateStats();
                }
            });
        }
    });

    if (mode === 'learn') {
        speak(vocabulary[currentIndex].c);
    }
}

function startSequentialAnimation(index) {
    if (index >= writers.length) {
        // ÂÖ®ÈÉ®ÊºîÁ§∫ÂÆåÊàêÔºåÊÅ¢Â§çÊ≠£Â∏∏
        divs.forEach(d => d.classList.remove('inactive', 'active'));
        return;
    }

    // ÊøÄÊ¥ªÂΩìÂâçÂ≠óÔºàÂéªÈô§ÁÅ∞Ëâ≤ + È´ò‰∫ÆËæπÊ°ÜÔºâ
    divs[index].classList.remove('inactive');
    divs[index].classList.add('active');

    writers[index].animateCharacter(() => {
        // ÂΩìÂâçÂ≠óÊºîÁ§∫ÂÆåÊàêÔºåÂéªÈô§È´ò‰∫ÆÔºåËøõÂÖ•‰∏ã‰∏Ä‰∏™
        divs[index].classList.remove('active');
        startSequentialAnimation(index + 1);
    });
}

function replaySingleChar(clickedIndex) {
    if (currentMode !== 'learn') return;

    // È´ò‰∫ÆÁÇπÂáªÁöÑÂ≠óÂπ∂ÊºîÁ§∫
    divs.forEach((d, i) => {
        if (i === clickedIndex) {
            d.classList.remove('inactive');
            d.classList.add('active');
        } else {
            d.classList.add('inactive');
            d.classList.remove('active');
        }
    });

    writers[clickedIndex].animateCharacter(() => {
        // ÊºîÁ§∫ÁªìÊùüÂêéÊÅ¢Â§çÁÅ∞Ëâ≤Áä∂ÊÄÅÔºàÈô§ÈùûÊòØÊúÄÂêé‰∏Ä‰∏™Ôºâ
        divs.forEach((d, i) => {
            d.classList.remove('active');
            if (i > clickedIndex) d.classList.add('inactive');
        });
    });
}

function render() {
    const item = vocabulary[currentIndex];
    document.getElementById('progress').innerText = currentIndex + 1;
    document.getElementById('pinyin-display').innerText = item.p;
    document.getElementById('meaning-display').innerText = item.m;
    document.getElementById('hint-area').innerText = "";
    document.getElementById('mode-description').innerText = modeDescriptions[currentMode];
    
    initWriters(item.c, currentMode);
}

function switchMode(m, specificIndex = null) {
    currentMode = m;
    if (specificIndex !== null) currentIndex = specificIndex;

    document.querySelectorAll('.nav-btns button').forEach(b => b.classList.remove('active-btn'));
    document.getElementById('btn-' + m).classList.add('active-btn');
    
    document.getElementById('list-view').style.display = (m === 'list') ? 'block' : 'none';
    document.getElementById('wrong-view').style.display = (m === 'wrong') ? 'block' : 'none';
    document.getElementById('info-view').style.display = (m === 'learn' || m === 'test' || m === 'quiz') ? 'block' : 'none';

    const titles = {learn: "Learn Mode", test: "Practice Mode", quiz: "Quiz Mode"};
    const texts = {
        learn: "Watch the animation and listen to the pronunciation. Then imitate the strokes.",
        test: "Write the character based on pinyin. Outline is visible. Correct writing moves to next.",
        quiz: "No hints at start. Write from memory. Click 'Show Hint' for faint outline if needed."
    };
    document.getElementById('info-title').innerText = titles[m] || "Mode Guide";
    document.getElementById('info-text').innerText = texts[m] || "";

    if (m === 'list') renderList();
    if (m === 'wrong') renderWrong();
    if (['learn', 'test', 'quiz'].includes(m)) render();
}

function showHint() {
    if (currentMode === 'quiz' && writers.length > 0 && !hintShown) {
        writers.forEach(w => w.showOutline());
        hintShown = true;
        document.getElementById('hint-area').innerText = "Faint outline shown";
    } else if (currentMode === 'learn' && writers.length > 0) {
        // ÈáçÊñ∞‰ªéÁ¨¨‰∏Ä‰∏™Â≠óÂºÄÂßãÈ°∫Â∫èÊºîÁ§∫
        divs.forEach(d => d.classList.add('inactive'), d.classList.remove('active'));
        startSequentialAnimation(0);
    }
}

function nextItem() {
    if (currentIndex < vocabulary.length - 1) {
        currentIndex++;
        render();
    } else {
        alert("Congratulations! You've reached the end!");
    }
}

function prevItem() {
    if (currentIndex > 0) {
        currentIndex--;
        render();
    }
}

function renderList() {
    const container = document.getElementById('list-view');
    container.innerHTML = "<h3>All Characters</h3>" + vocabulary.map((v, i) => `
        <div class="list-card" onclick="switchMode('learn', ${i})">
            <span class="list-char">${v.c}</span>
            <div style="margin-left:20px;"><span style="color:var(--pinyin-red); font-weight:bold;">${v.p}</span><br><small>${v.m}</small></div>
        </div>`).join('');
}

function renderWrong() {
    const container = document.getElementById('wrong-view');
    if (!wrongAnswers.length) { 
        container.innerHTML = "<p style='text-align:center;'>No mistakes yet! Keep going!</p>"; 
        return; 
    }
    container.innerHTML = "<h3>Mistakes</h3>" + wrongAnswers.map(v => {
        const idx = vocabulary.findIndex(it => it.c === v.c);
        return `<div class="list-card" onclick="switchMode('quiz', ${idx})"><span class="list-char"><b>${v.c}</b></span><div style="margin-left:15px;"><span>${v.p}</span><br><small>${v.m}</small></div></div>`;
    }).join('');
}

function speak(t) { 
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(t); 
        utter.lang = 'zh-CN'; 
        utter.rate = 0.8; 
        window.speechSynthesis.speak(utter); 
    }
}

function updateStats() {
    document.getElementById('stat-done').innerText = vocabulary.length - wrongAnswers.length;
}

function enterApp() { 
    document.getElementById('cover-page').style.opacity = '0'; 
    setTimeout(() => { 
        document.getElementById('cover-page').style.display = 'none'; 
        switchMode('learn'); 
    }, 500); 
}

window.addEventListener('resize', () => { if (writers.length > 0) render(); });
</script>
</body>
</html>